---
title: "02e_correlations"
output: md_document
---

```{r setup}
library(tidyverse) 
library(corrplot)
library(cowplot)
library(corrr)

knitr::opts_chunk$set(fig.path = '../figures/02e_correlations/', cache = F)
```    
For this analysis, I want to explor correlations between a behavioral measure and gene expression.

```{r behavior}
# import behavior data, create mouse id, select relvant samples
behav <- read.csv("../data/01a_behavior.csv") 
behav$mouse <- sapply(strsplit(as.character(behav$ID),"15"), "[", 2)
behav <- behav %>% filter( #treatment %in% c("conflict.trained", "standard.trained"),
                                  TrainSessionCombo == "Retention") %>% 
                           select(mouse,Time1stEntr,pTimeShockZone) 
head(behav)
```
```{r pca}
pcadata <- read_csv("../data/01a_pcadf.csv") %>%
  filter(#treatment %in% c("conflict.trained", "standard.trained"),
         TrainSessionComboNum == 9) %>%
  select(ID,PC1,PC2) 
pcadata$mouse <- sapply(strsplit(as.character(pcadata$ID),"15"), "[", 2)
pcadata$ID <- NULL
head(pcadata)
```

```{r DEGs}
DG_DEGs <- read.csv("../data/02f_DG_DEGs_vsd.csv", row.names = 1, check.names = F)
DG_DEGs <- as.data.frame(t(DG_DEGs))
DG_DEGs$sample <- row.names(DG_DEGs)
DG_DEGs$mouse <- sapply(strsplit(as.character(DG_DEGs$sample),"\\-"), "[", 1)
DG_DEGs <- DG_DEGs %>% select(mouse,`1190002N15RIK`:ZFP869)
DG_DEGs

```

```{r joining}
DEGsPCA <- left_join(DG_DEGs, pcadata)
DEGsPCAbeahv <- left_join(DEGsPCA, behav)
DEGsPCAbeahv <- as.data.frame(DEGsPCAbeahv)
row.names(DEGsPCAbeahv) <- DEGsPCAbeahv$mouse
DEGsPCAbeahv$mouse <- NULL
DEGsPCAbeahv <- as.matrix(DEGsPCAbeahv)
```

```{r corrr}
DGcor <- DEGsPCAbeahv %>% correlate() %>% rearrange() %>%  shave()
DGcor

DGcorSlim <- correlate(DEGsPCAbeahv) %>%  
  focus(PC1,PC2,Time1stEntr, pTimeShockZone)  

DGcorarranged <- fashion(DGcorSlim) %>% arrange(desc(PC1))
DGcorarranged
```

```{r}
DEGsPCAbeahvDf <- as.data.frame(DEGsPCAbeahv)
a <- ggplot(DEGsPCAbeahvDf, aes(x = PC1, y = NAF1, label = rownames(DEGsPCAbeahvDf))) +
  geom_point( ) + geom_smooth(method='lm', colour = "darkgrey") + geom_text(vjust = -0.1)
b <- ggplot(DEGsPCAbeahvDf, aes(x = Time1stEntr, y = NAF1, label = rownames(DEGsPCAbeahvDf))) +
  geom_point( ) + geom_smooth(method='lm', colour = "darkgrey") + geom_text(vjust = -0.1)

c <- ggplot(DEGsPCAbeahvDf, aes(x = PC1, y = ARC, label = rownames(DEGsPCAbeahvDf))) +
  geom_point(colour = "darkred") + geom_smooth(method='lm', colour = "darkgrey") + geom_text(vjust = -0.1)
d <- ggplot(DEGsPCAbeahvDf, aes(x = Time1stEntr, y = ARC, label = rownames(DEGsPCAbeahvDf))) +
  geom_point(colour = "darkred") + geom_smooth(method='lm', colour = "darkgrey") + geom_text(vjust = -0.1)


a
b

```
