---
title: "02e_correlations"
output: md_document
---

```{r setup}
library(tidyverse) 
library(corrplot)
library(cowplot)
library(corrr)
#devtools::install_github("clauswilke/ggtext")
library(ggtext)

source("figureoptions.R")

knitr::opts_chunk$set(fig.path = '../figures/02e_correlations/', cache = F)
```    
For this analysis, I want to explor correlations between a behavioral measure and gene expression.

```{r behavior}
# import behavior data, create mouse id, select relvant samples
behav <- read.csv("../data/01a_behavior.csv") 
behav$mouse <- sapply(strsplit(as.character(behav$ID),"15"), "[", 2)
behav <- behav %>% filter( #treatment %in% c("conflict.trained", "standard.trained"),
                                  TrainSessionCombo == "Retention") %>% 
                           select(mouse,Time1stEntr,pTimeShockZone) 
head(behav)
```
```{r pca}
pcadata <- read_csv("../data/01a_pcadf.csv") %>%
  filter(#treatment %in% c("conflict.trained", "standard.trained"),
         TrainSessionComboNum == 9) %>%
  select(ID,PC1,PC2) 
pcadata$mouse <- sapply(strsplit(as.character(pcadata$ID),"15"), "[", 2)
pcadata$ID <- NULL
head(pcadata)
```

```{r DEGs}
DG_DEGs <- read.csv("../data/02f_DG_DEGs_vsd.csv", row.names = 1, check.names = F)
DG_DEGs <- as.data.frame(t(DG_DEGs))
DG_DEGs$sample <- row.names(DG_DEGs)
DG_DEGs$mouse <- sapply(strsplit(as.character(DG_DEGs$sample),"\\-"), "[", 1)
DG_DEGs <- DG_DEGs %>% select(mouse,`1190002N15RIK`:ZFP869)
DG_DEGs
```

```{r joining}
DEGsPCA <- left_join(DG_DEGs, pcadata)
DEGsPCAbeahv <- left_join(DEGsPCA, behav)
DEGsPCAbeahv <- as.data.frame(DEGsPCAbeahv)
row.names(DEGsPCAbeahv) <- DEGsPCAbeahv$mouse
DEGsPCAbeahv$mouse <- NULL
DEGsPCAbeahv <- as.matrix(DEGsPCAbeahv)
```

```{r corrr}
DGcor <- DEGsPCAbeahv %>% correlate() %>% rearrange() %>%  shave()
DGcor

DGcorSlim <- correlate(DEGsPCAbeahv) %>%  
  focus(PC1,PC2,Time1stEntr, pTimeShockZone)  

DGcorarranged <- fashion(DGcorSlim) %>% arrange(desc(PC1))
DGcorarranged
```

```{r}
mousetreatment <- read_csv("../data/01a_behavior.csv")  %>%
  filter(TrainSessionCombo == "Retention") %>%
  mutate(mouse = sapply(strsplit(as.character(ID),"15"), "[", 2)) %>%
  select(mouse, treatment)
mousetreatment


DEGsPCAbeahvDf <- as.data.frame(DEGsPCAbeahv)
DEGsPCAbeahvDf$mouse <- row.names(DEGsPCAbeahvDf)
DEGsPCAbeahvDf <- left_join(mousetreatment, DEGsPCAbeahvDf)

theme_ms <- function () { 
  theme_classic(base_size = 10) +
    theme(
      panel.grid.major  = element_blank(),  # remove major gridlines
      panel.grid.minor  = element_blank(),  # remove minor gridlines
      plot.title = element_text(hjust = 0.5, face = "bold") # center & bold 
    )
}

a <- ggplot(DEGsPCAbeahvDf, aes(x = PC1, y = ARC)) +
  geom_point(aes(color = treatment)) + geom_smooth(method='lm', colour = "darkgrey")  +
  labs(y = "ARC expression in DG (variance stabilized)", 
       x = "behavior PC1 \n decreasing avoidance behavior -->",
       subtitle = "R2 = 0.5864, p = 0.0003") +
  theme_ms() +
  scale_color_manual(values = treatmentcolors) + theme(legend.position = "none")
  
b <- ggplot(DEGsPCAbeahvDf, aes(x = PC1, y = FOSL2)) +
  geom_point(aes(color = treatment)) + geom_smooth(method='lm', colour = "darkgrey") +
  labs(y = "FOSL2 expression in DG (variance stabilized)", 
       x = "behavior PC1 \n decreasing avoidance behavior -->",
       subtitle = "R2 = 0.6412, p = 0.0001") +
    theme_ms() +
  scale_color_manual(values = treatmentcolors) + theme(legend.position = "none")

plot_grid(a,b)

summary(lm(ARC ~ PC1, data = DEGsPCAbeahvDf))
summary(lm(FOSL2 ~ PC1, data = DEGsPCAbeahvDf))

```
