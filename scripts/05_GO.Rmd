---
title: "GO Analysis"
output: md_document
---

```{r setup, include=FALSE}
library(tidyverse)
library(knitr)
library(kableExtra)

knitr::opts_chunk$set(echo = TRUE)
```


## Hypothesised GO Terms

```{r}
GO_response <- read.table("../data/goterms/01_responsetostimulus.txt", sep = "\t", row.names = NULL,  fill=TRUE)
GO_response$GO <- "1. Response to Stimulus (GO:0050896)"

GO_translation <- read.table("../data/goterms/02_translation.txt", sep = "\t", row.names = NULL)
GO_translation$GO <- "2. Translation (GO:0006412)"

GO_synapse <- read.table("../data/goterms/03_synapseorganization.txt", sep = "\t", row.names = NULL)
GO_synapse$GO <- "3. Synapse Organization (GO:0050808)"

GO_learningormemory <- read.table("../data/goterms/04_learningormemory.txt", sep = "\t", row.names = NULL)
GO_learningormemory$GO <- "4. Learning or Memory (GO:0007611)"

GOterms <- rbind(GO_learningormemory, GO_response, GO_translation, GO_synapse)
GOterms <- GOterms %>%
  dplyr::mutate(gene = str_to_title(MGI.Gene.Marker.ID)) %>% 
  dplyr::select(gene, GO) %>% 
  dplyr::distinct(gene, GO) %>% 
 group_by(gene) 
GOterms

```

## Upregulated DG DEGS


```{r}
DGDEGs <- read_csv("../data/suppltable-4.csv") %>% 
  filter(tissue == "DG", comparison == "yoked vs. trained")
DGDEGs$gene

GOtermsDEGs <- inner_join(GOterms, DGDEGs) %>%
  arrange(GO,gene) %>%
  dplyr::select(gene, GO) %>% 
  group_by(GO) %>%
  summarize(genes = str_c(gene, collapse = ", "))
head(GOtermsDEGs)
```

## are genes in GO term significant? what about random GO terms and significantly enriched GO terms

Random 1 from http://geneontology.org/docs/ontology-documentation/ 
The larger processes, or ‘biological programs’ accomplished by multiple molecular activities. **Examples of broad biological process terms** are _DNA repair_ or _signal transduction_. Examples of more specific terms are _pyrimidine nucleobase biosynthetic process_ or _glucose transmembrane transport_. Note that a biological process is not equivalent to a pathway. At present, the GO does not try to represent the dynamics or dependencies that would be required to fully describe a pathway. Examples of broad biological process terms are DNA repair or signal transduction. Examples of more specific terms are pyrimidine nucleobase biosynthetic process or glucose transmembrane transport. Found all those at http://www.informatics.jax.org/vocab/gene_ontology

Random 2 from https://www.biorxiv.org/content/10.1101/2020.01.26.920447v1.full.pdf


_Note: "pyrimidine nucleobase biosynthetic process" was too small, so I went up to leveles and chose "heterocycle biosynthetic process" instead._

Top 4 GO terms from http://bioinformatics.sdstate.edu/go/ identified with 214 DG DEGs. 

![](../figures/05_GO/Screen Shot 2020-01-30 at 11.19.35 AM.png)


```{r moreGOterms}
# https://serialmentor.com/blog/2016/6/13/reading-and-combining-many-tidy-data-files-in-R

data_path <- "../data/goterms/"   # path to the data
files <- dir(data_path, pattern = "*.txt") # get file names

filesdf <- as.data.frame(files)
filesdf$source <- c(1:17)
filesdf

data <- files %>%
  # read in all the files, appending the path before the filename
  map_df(~ read.table(file.path(data_path, .),  sep = "\t", 
                      row.names = NULL,  fill=TRUE), .id = "source") %>%
  mutate(source = as.numeric(source)) %>%
  select(source, MGI.Gene.Marker.ID) %>%
  left_join(filesdf, .)  %>% 
  mutate_at(.vars = "files",  .funs = gsub,
            pattern = ".txt", replacement = "") %>%
  dplyr::rename("GO" = "files",
         "gene" = "MGI.Gene.Marker.ID") %>%
  dplyr::select(GO, gene)
head(data)

GOtermsDEGs2 <- inner_join(data, DGDEGs) %>%
  arrange(GO,gene) %>%
  dplyr::select(gene, GO) %>% 
  dplyr::distinct(gene, GO) %>% 
  group_by(GO) %>%
  summarize(genes = str_c(gene, collapse = ", "))
head(GOtermsDEGs2)

totalGOterm3 <- data %>%
  group_by(GO) %>%
  summarise(totalgenes = n())

totalSignificantgenesperGO3 <- inner_join(data, DGDEGs) %>%
  arrange(GO,gene) %>%
  dplyr::select(gene, GO) %>% 
  dplyr::distinct(gene, GO) %>% 
  group_by(GO) %>%
  summarise(significantgenes = n())
totalSignificantgenesperGO3

GOsummary3 <- full_join(totalGOterm3, totalSignificantgenesperGO3) %>%
  mutate(percent = significantgenes / totalgenes * 100) %>%
  mutate(percent = round(percent,2)) %>%
  mutate(category = ifelse(grepl("01|02|03|04", GO), "hypothesis",
                          ifelse(grepl("05|06|07|08", GO), "ShinyGO",
                                 ifelse(grepl("09|10|11|12", GO), "random", 
                                        ifelse(grepl("13|14|15|16|17", GO), "PANTHER", NA))))) %>%
  select(category, GO, totalgenes, significantgenes, percent)   %>%
  arrange(desc(percent)) %>%
  left_join(.,GOtermsDEGs2)
GOsummary3

write.csv(GOtermsDEGs2, "../data/05_GOtermsDEGs2.csv", row.names = F)
write.csv(GOsummary3, "../data/05_GOsummary3.csv", row.names = F)

```



## sanes

```{r}
sanesLichtman <- read_csv("../data/05_sanesLichtman.csv")  %>% 
  dplyr::rename("gene" = "genes") %>%
  dplyr::mutate(gene = str_to_title(gene))
str(sanesLichtman)

GOtermssanesLichtman <- left_join(sanesLichtman, data) %>%
  arrange(GO,gene) %>%
  dplyr::select(gene, GO) %>% 
   dplyr::distinct(gene, GO) %>% 
 group_by(GO) %>%
 summarize(genes = str_c(gene, collapse = ", "))
GOtermssanesLichtman

GOtermssanesLichtmansummary <- left_join(sanesLichtman, data) %>%
  arrange(GO,gene) %>%
  dplyr::select(gene, GO) %>% 
   dplyr::distinct(gene, GO) %>% 
 group_by(GO) %>%
 summarize(SanesLichtman = n())
GOtermssanesLichtmansummary

full_join(GOsummary3, GOtermssanesLichtmansummary) %>% 
  mutate(SLpercent = SanesLichtman / totalgenes * 100)  %>% 
  mutate(SLpercent = round(SLpercent, 2))  %>% 
  select(category, GO, totalgenes, SanesLichtman, SLpercent, significantgenes, percent) %>% 
  filter(category != "ShinyGO")  %>%
  drop_na()



```

## DEGs and Sanes and top 10 memory genes


```{r}
candidategenes <- c("Camk2a" ,  "Gria2",  "Igf2" , "Nsf" , "Pick1",
                        "Prkcb" ,  "Prkci",  "Prkcz", "Wwc1" ,
          "Fmr1", "Mtor")
candidategenes <- as.data.frame(candidategenes) %>%
  dplyr::rename("gene" = "candidategenes")

candidatesGO <- left_join(candidategenes, data, by = "gene")  %>%
  arrange(GO,gene) %>%
  dplyr::select(gene, GO) %>% 
  dplyr::distinct(gene, GO) %>% 
 group_by(GO) %>%
 summarize(genes = str_c(gene, collapse = ", "))
candidatesGO

AllGOgenelists <- full_join(candidatesGO, GOtermssanesLichtman, by = "GO") %>% 
  full_join(., GOtermsDEGs2, by = "GO") %>% 
  dplyr::rename("candidates" = "genes.x", 
         "SanesLichtman" ="genes.y", 
         "DG DEGs"  = "genes") %>% 
  arrange(GO) %>%
  filter(GO != "NA") %>%
  mutate(category = ifelse(grepl("01|02|03|04", GO), "hypothesis",
                          ifelse(grepl("05|06|07|08", GO), "ShinyGO",
                                 ifelse(grepl("09|10|11|12", GO), "random", 
                                 ifelse(grepl("13|14|15|16|17", GO), "PANTHER", NA))))) %>%
  select(category, everything())
  
AllGOgenelists 

write_csv(AllGOgenelists, "../data/05_GO_AllGOgenelists.csv")

```


## PC1 correlations

```{r}
corrsPC1sig <- read_csv("../data/04_corrsPC1sig.csv")
corrsPC1sig$gene

## these 58 genes were used for a go analysis using shinygo http://bioinformatics.sdstate.edu/go/
## results are stored as 
  #data/05_GO_PC1enrichmentBP.csv
	#data/05_GO_PC1enrichmentCC.csv
	#data/05_GO_PC1enrichmentMF.csv

BP <- read_csv("../data/05_GO_PC1enrichmentBP.csv", n_max = 5) %>% mutate(Domain = "BP") 
CC <- read_csv("../data/05_GO_PC1enrichmentCC.csv", n_max = 5) %>% mutate(Domain = "CC") 
MF <- read_csv("../data/05_GO_PC1enrichmentMF.csv", n_max = 5) %>% mutate(Domain = "MF") 

GO_PC1 <- rbind(BP, CC, MF) %>% 
  select(Domain, `Functional Category`, `Total genes`, `Genes in list`, Genes) %>%
  rename(gene = Genes) %>%
  dplyr::mutate(gene = str_to_title(gene))

# alphabetize
GO_PC1$gene <- GO_PC1$gene %>% str_split(., ' ') %>% 
  lapply(., 'sort') %>%  
  lapply(., 'paste', collapse=' ') %>% 
  unlist(.)

kable(GO_PC1) 
```

## for GOrilla

```{r}
backgroundgeneset <- read_csv("../data/00_geneids.csv") %>% 
  select(gene) %>%
  distinct(gene) %>%
  arrange(gene)
head(backgroundgeneset,20)

write.csv(backgroundgeneset, "../data/05_GO_backgroundgeneset.csv", row.names = F)
```



```{r write}
write.csv(GO_PC1, "../data/05_GO_PC1.csv", row.names = F)
```