---
title: "Behavior Analysis"
author: "Rayna M Harris"
date: "11/15/2016"
output: md_document
---

This is an R Markdown document detailing the behavior data analysis.

#### Import the behavior data and functions
```{r}
behavior <- read.csv("../data/01_behaviordata.csv", header = T)
behavior$APA <- factor(behavior$APA, levels = c("Yoked", "Same", "Conflict"))
```

```{r import funciton}
source("01_behaviorfunctions.R")
```

```{r, echo=FALSE, message=FALSE}
## load libraries -----
library(magrittr) ## to use the weird pipe
library(ggplot2) ## for awesome plots!
library(gplots) ##for making awesome plots
library(cowplot) ## for some easy to use themes
library(tidyr) ## for respahing data
library(plyr) ## for renmaing factors
library(dplyr) ## for filtering and selecting rows
library(reshape2) ## for melting dataframe
library(pheatmap)
```

#### Mice learn to avoid the shock zone and they remember 24 hours later! 

```{r, echo=FALSE}


a1 <- onebehavior(data=behavior, xcol="TrainSessionComboNum", ycol="pTimeOPP",
                 yaxislabel=" Proportion of time spent\n opposite the shock zone",
                 colorcode="APA")
a2 <- myboxplot(data = behavior, xcol = "TrainSessionCombo", 
                ycol = "NumEntrances", colorcode = "APA", 
                session ="Retention",
                yaxislabel="\n Number of Entrances") 

b1 <- onebehavior(data=behavior, xcol="TrainSessionComboNum", ycol="Time1stEntr",
                 yaxislabel="\n Time to 1st Entrance (s)",
                 colorcode="APA")
b2 <- myboxplot(data = behavior,xcol = "TrainSessionCombo", 
                ycol = "Time1stEntr", colorcode = "APA", session ="Retention",
                yaxislabel="\n Time to 1st Entrance (s)")

plot_grid(a1,a2,b1,b2,nrow=2, rel_widths=c(0.6, 0.4), labels=c("A1", "A2", "B1", "B2"))
a1
a2
b1
b2

```

### stats
```{r, echo=FALSE, message=FALSE}

behavior$Time1stEntrLog <- log(behavior$Time1stEntr)
retention <- behavior %>% filter(TrainSessionCombo == "Retention") %>%  droplevels() 

######## Leven Test
# is variance signficant? Yes. Not conna be able to use anova
library(car)
leveneTest(Time1stEntr~APA, data=retention)
# group  2  5.3551 0.01005 *  ==> significant, need to transform
leveneTest(Time1stEntrLog~APA, data=retention)
# group  2    0.23 0.7959  ==>  yeah, no longer signfifcant. can do anova
leveneTest(NumEntrances~APA, data=retention)
#group  2  0.8582 0.4337  ==> not significant, can do anova

######### one way anova on tetentino
avoTime <- aov(retention$Time1stEntrLog ~ retention$APA)
summary(avoTime)
TukeyHSD(avoTime)
#$`retention$APA`
#                     diff        lwr       upr     p adj
#Same-Yoked      2.2196969  0.8577240 3.5816697 0.0010054
#Conflict-Yoked  1.5470339  0.2375238 2.8565440 0.0178203
#Conflict-Same  -0.6726629 -2.2162321 0.8709063 0.5378898

avoNum <- aov(retention$NumEntrances ~ retention$APA)
summary(avoNum)
TukeyHSD(avoNum)
#                     diff        lwr       upr     p adj
#Same-Yoked     -12.161765 -16.963276 -7.360253 0.0000019
#Conflict-Yoked  -9.967320 -14.583879 -5.350761 0.0000255
#Conflict-Same    2.194444  -3.247269  7.636158 0.5870227

### liear modle
mymodel <- lm(behavior$Time1stEntrLog ~ behavior$APA * behavior$TrainSessionCombo)
qqnorm(mymodel$residuals)
qqline(mymodel$residuals,col='red')
plot(mymodel$fitted.values,mymodel$residuals)
abline(h=0, col='red')
summary(mymodel)

mymodel2 <- lm(behavior$NumEntrances ~ behavior$APA * behavior$TrainSessionCombo)
qqnorm(mymodel2$residuals)
qqline(mymodel2$residuals,col='red')
plot(mymodel2$fitted.values,mymodel2$residuals)
abline(h=0, col='red')
summary(mymodel2)

## predictions
library(relaimpo)
(m1relaimpo <- calc.relimp(mymodel, type = "lmg", rela = TRUE))


```



#### Reshape data and plot a heatmap of group average values 

```{r, message=FALSE, results='hide', echo=FALSE}
makeagroupaveheatmap(behavior)
makeagroupaveheatmap(retention)
makesessionheatmap(behavior)

```

#### Reshape data and plot a correlation matrix
```{r, message=FALSE, results='hide', echo=FALSE}
makecorrelationheatmap(data=retention, APAgroup = "Conflict", clusterTF =T)
makecorrelationheatmap(data=retention, APAgroup = "Same", clusterTF =T)
makecorrelationheatmap(data=retention, APAgroup = "Yoked", clusterTF =T)
```

#### Reshape data and plot a PCA
```{r, echo=FALSE}
scoresdf <- makepcadf(behavior)
makepcaplot(data=scoresdf,xcol="PC1",ycol="PC2",colorcode="APA")
makepcaplot(data=scoresdf,xcol="PC1",ycol="PC3",colorcode="APA")
makepcaplot(data=scoresdf,xcol="PC1",ycol="PC6",colorcode="APA")

```





