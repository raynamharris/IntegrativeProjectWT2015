---
title: "Behavior Analysis"
author: "Rayna M Harris"
date: "11/15/2016"
output: html_document
---

This is an R Markdown document detailing the behavior data analysis.

#### Import the behavior data and functions
```{r}
behavior <- read.csv("~/Github/IntegrativeProjectWT2015/data/01_behaviordata.csv", header = T)
```

```{r import funciton}
source("01_behaviorfunctions.R")
```

```{r, echo=FALSE, message=FALSE}
## load libraries -----
library(magrittr) ## to use the weird pipe
library(ggplot2) ## for awesome plots!
library(gplots) ##for making awesome plots
library(cowplot) ## for some easy to use themes
library(tidyr) ## for respahing data
library(dplyr) ## for filtering and selecting rows
library(reshape2) ## for melting dataframe
#library(plyr) ## for renmaing factors
library(pheatmap)
```

#### Plot behavior data by session
```{r}
a <- onebehaviornolegend(data=behavior, xcol="TrainSessionComboNum", ycol="Path1stEntr", 
             yaxislabel="Path to 1st Entrance (m)", colorcode="APA")
b <- onebehaviornolegend(data=behavior, xcol="TrainSessionComboNum", ycol="Path2ndEntr",
             yaxislabel="Path to\n2nd Entrance (m)", colorcode="APA")
c <- onebehavior(data=behavior, xcol="TrainSessionComboNum", ycol="TotalPathArena.m",
             yaxislabel="Total Path (m)", colorcode="APA")
d <- onebehaviornolegend(data=behavior, xcol="TrainSessionComboNum", ycol="pTimeTarget",
             yaxislabel="% Time in the Shock Zone", colorcode="APA")
e <- onebehaviornolegend(data=behavior, xcol="TrainSessionComboNum", ycol="pTimeOPP",
             yaxislabel="% Time Opposite\nof the Shock Zone", colorcode="APA")
f <- onebehavior(data=behavior, xcol="TrainSessionComboNum", ycol="SpeedArena.cm.s",
             yaxislabel="Average Speed (cm/s)", colorcode="APA")


plot_grid(a,b,c,d,e,f,nrow=2, rel_widths=c(1,1.1,1.75,1,1.1,1.75))
```



#### Reshape data and plot a heatmap of group average values
```{r}
behaviorAPAaverages <- makeagroupmatrix(behavior) 
head(behaviorAPAaverages)
```


```{r, echo=FALSE}
behav_annot <- as.data.frame(colnames(behaviorAPAaverages))
names(behav_annot)[names(behav_annot)=="colnames(behaviorAPAaverages)"] <- "APA"
rownames(behav_annot) <- behav_annot$APA
behav_colors = list(
  APA =  c(Yoked = (values=c("#878787")), Same = (values=c("#f4a582")),
            Conflict = (values=c("#b2182b"))))
pheatmap(behaviorAPAaverages, 
         show_colnames=FALSE, show_rownames=TRUE,
         annotation_col = behav_annot, 
         annotation_colors = behav_colors,
         annotation_names_col=TRUE,
         fontsize = 15, fontsize_row = 8, fontsize_col = 10,
         cellwidth=75, 
         height = 3,
         border_color = "grey60"
)
```
