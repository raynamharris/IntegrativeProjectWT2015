---
title: "Behavior Analysis"
author: "Rayna M Harris"
date: "11/15/2016"
output: html_document
---

This is an R Markdown document detailing the behavior data analysis.

#### Import the behavior data and functions
```{r}
behavior <- read.csv("~/Github/IntegrativeProjectWT2015/data/01_behaviordata.csv", header = T)
behavior$APA <- factor(behavior$APA, levels = c("Yoked", "Same", "Conflict"))
```

```{r import funciton}
source("01_behaviorfunctions.R")
```

```{r, echo=FALSE, message=FALSE}
## load libraries -----
library(magrittr) ## to use the weird pipe
library(ggplot2) ## for awesome plots!
library(gplots) ##for making awesome plots
library(cowplot) ## for some easy to use themes
library(tidyr) ## for respahing data
library(dplyr) ## for filtering and selecting rows
library(reshape2) ## for melting dataframe
library(pheatmap)
```

#### Mice learn to avoid the shock zone and they remember 24 hours later! 

```{r, echo=FALSE}
a <- myboxplot(data = behavior,xcol = "TrainSessionCombo", ycol = "pTimeOPP", yaxislabel = "% Time Spent Opposite of the Shock Zone", colorcode = "APA", session ="Retention")
b <- myboxplot(data = behavior,xcol = "TrainSessionCombo", ycol = "Path1stEntr", yaxislabel = "Path to 1st Shock Zone Entrance  (m)", colorcode = "APA", session ="Retention")
c <- onebehavior(data=behavior, 
                 xcol="TrainSessionComboNum", 
                 ycol="Time2ndEntr",
             yaxislabel="Time to 2nd Shock Zone Entrance (s)", colorcode="APA")
plot_grid(a,b,c, nrow=1, rel_widths = c(0.25,0.25, 0.5)) 

ggplot(data = behavior, aes(x=APA, y=pTimeOPP, fill = factor(TrainGroup))) +
  geom_boxplot()

## add text to R script


```

### stats
```{r, echo=FALSE, message=FALSE}
library(nlme)
T4_C1 <- behavior %>% filter(TrainSessionCombo %in% c("T4_C1")) %>%  droplevels() 
nlme1 <- lme(Path2ndEntr  ~ APA ,
              random = ~ 1|ID,
              data = T4_C1)
summary(nlme1)

T6_C3 <- behavior %>% filter(TrainSessionCombo %in% c("T6_C3")) %>%  droplevels()
nlme2 <- lme(Path2ndEntr  ~ APA ,
              random = ~ 1|ID,
              data = T6_C3)
summary(nlme2)

retention <- behavior %>% filter(TrainSessionCombo %in% c("Retention")) %>%  droplevels()
nlme3 <- lme(Path1stEntr  ~ APA ,
              random = ~ 1|ID,
              data = retention)
summary(nlme3)

```

#### Plot behavior data by session
```{r, echo=FALSE}
c <- onebehavior(data=behavior, 
                 xcol="TrainSessionComboNum", 
                 ycol="Time2ndEntr",
             yaxislabel="Time to 2nd Shock Zone Entrance (s)", colorcode="APA")

b2
plot_grid(a,b,c,d,e,f,nrow=2, rel_widths=c(1,1.1,1.75,1,1.1,1.75))
```


#### Reshape data and plot a heatmap of group average values 

```{r, message=FALSE, results='hide', echo=FALSE}
makeagroupaveheatmap(behavior)
```

#### Reshape data and plot a correlation matrix
```{r, message=FALSE, results='hide', echo=FALSE}
makecorrelationheatmap(data=behavior, APAgroup = "Conflict", clusterTF =T)
makecorrelationheatmap(data=behavior, APAgroup = "Same", clusterTF =T)
makecorrelationheatmap(data=behavior, APAgroup = "Yoked", clusterTF =T)
```

#### Reshape data and plot a PCA
```{r, echo=FALSE}
scoresdf <- makepcadf(behavior)
makepcaplot(data=scoresdf,xcol="PC1",ycol="PC2",colorcode="APA")
makepcaplot(data=scoresdf,xcol="PC1",ycol="PC4",colorcode="APA")
```





